<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DONTRADING - Investment Dashboard v2.1</title>
    <!-- Firebase SDKs (misma versiÃ³n que login.html) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --bg-primary: #0a0e17; --bg-sidebar: #0d1220; --bg-card: #111827;
            --bg-tab-bar: #0d1220; --bg-tab-active: #1a2234;
            --accent: #f59e0b; --accent-soft: #d97706;
            --text-primary: #f1f5f9; --text-secondary: #94a3b8; --text-muted: #64748b;
            --border: #1e293b; --border-light: #334155;
            --positive: #22c55e; --negative: #ef4444;
        }
        body { font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); overflow: hidden; height: 100vh; }
        .app-container { display: flex; width: 100%; height: 100vh; background-color: var(--bg-primary); color: var(--text-primary); overflow: hidden; }

        /* â”€â”€ SIDEBAR â”€â”€ */
        .sidebar { display: flex; flex-direction: column; align-items: center; width: 64px; min-width: 64px; background-color: var(--bg-sidebar); border-right: 1px solid var(--border); overflow-y: auto; scrollbar-width: none; }
        .sidebar::-webkit-scrollbar { display: none; }
        .sidebar-logo { padding: 16px 0 12px; }
        .logo-container { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, var(--accent), var(--accent-soft)); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; color: var(--bg-primary); }
        .sidebar-divider { width: 32px; height: 1px; background-color: var(--border); margin-bottom: 8px; }
        .sidebar-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 3px; width: 56px; padding: 8px 0; margin: 1px 0; border-radius: 8px; cursor: pointer; transition: all 0.15s ease; background-color: transparent; border-left: 2px solid transparent; }
        .sidebar-item.active { background-color: rgba(245, 158, 11, 0.08); border-left: 2px solid var(--accent); }
        .sidebar-item:hover:not(.active) { background-color: rgba(245, 158, 11, 0.04); }
        .sidebar-icon { width: 20px; height: 20px; stroke: var(--text-muted); stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; fill: none; }
        .sidebar-item.active .sidebar-icon { stroke: var(--accent); }
        .sidebar-label { font-size: 9px; font-weight: 400; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; line-height: 1; }
        .sidebar-item.active .sidebar-label { font-weight: 600; color: var(--accent); }

        /* â”€â”€ SIDEBAR PROFILE (reemplaza el logo DT) â”€â”€ */
        .sidebar-profile { padding: 12px 0; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; }
        .sidebar-avatar { width: 38px; height: 38px; border-radius: 12px; object-fit: cover; border: 2px solid var(--border); transition: all 0.2s ease; background-color: var(--bg-card); }
        .sidebar-avatar:hover { border-color: var(--accent); box-shadow: 0 0 12px rgba(245, 158, 11, 0.25); }
        .sidebar-avatar-fallback { width: 38px; height: 38px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent-soft)); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 15px; color: var(--bg-primary); border: 2px solid var(--border); transition: all 0.2s ease; }
        .sidebar-avatar-fallback:hover { border-color: var(--accent); box-shadow: 0 0 12px rgba(245, 158, 11, 0.25); }

        /* â”€â”€ PROFILE POPUP â€” position:fixed para evitar clipping del sidebar â”€â”€ */
        .profile-popup { display: none; position: fixed; background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 0; min-width: 260px; z-index: 9999; box-shadow: 0 12px 40px rgba(0,0,0,0.5); overflow: hidden; }
        .profile-popup.open { display: block; animation: popupSlideIn 0.2s ease; }
        @keyframes popupSlideIn { from { opacity: 0; transform: translateX(-6px); } to { opacity: 1; transform: translateX(0); } }
        .profile-popup-header { padding: 16px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid var(--border); background: rgba(245, 158, 11, 0.03); }
        .profile-popup-avatar { width: 42px; height: 42px; border-radius: 10px; object-fit: cover; border: 2px solid var(--accent); flex-shrink: 0; }
        .profile-popup-avatar-fallback { width: 42px; height: 42px; border-radius: 10px; background: linear-gradient(135deg, var(--accent), var(--accent-soft)); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 16px; color: var(--bg-primary); flex-shrink: 0; }
        .profile-popup-info { min-width: 0; }
        .profile-popup-name { font-size: 14px; font-weight: 700; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .profile-popup-email { font-size: 11px; color: var(--text-muted); word-break: break-all; margin-top: 2px; }
        .profile-popup-actions { padding: 6px; }
        .profile-popup-btn { display: flex; align-items: center; gap: 10px; width: 100%; padding: 10px 12px; border: none; background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 13px; font-weight: 500; border-radius: 8px; cursor: pointer; transition: all 0.15s ease; }
        .profile-popup-btn:hover { background: rgba(239, 68, 68, 0.08); color: var(--negative); }
        .profile-popup-btn svg { width: 18px; height: 18px; stroke: currentColor; stroke-width: 1.8; fill: none; flex-shrink: 0; }
        .profile-popup-overlay { display: none; position: fixed; inset: 0; z-index: 9998; }
        .profile-popup-overlay.open { display: block; }

        /* â”€â”€ MAIN CONTENT â”€â”€ */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

        /* â”€â”€ TAB BAR â”€â”€ */
        .tab-bar { display: flex; align-items: center; background-color: var(--bg-tab-bar); border-bottom: 1px solid var(--border); height: 42px; min-height: 42px; padding-left: 4px; padding-right: 12px; }
        .tab-container { display: flex; align-items: center; flex: 1; overflow-x: auto; gap: 1px; scrollbar-width: none; }
        .tab-container::-webkit-scrollbar { display: none; }
        .tab { display: flex; align-items: center; gap: 8px; padding: 0 14px; height: 34px; border-radius: 8px 8px 0 0; cursor: pointer; flex-shrink: 0; white-space: nowrap; transition: all 0.15s ease; background-color: transparent; border-bottom: 2px solid transparent; }
        .tab.active { background-color: var(--bg-tab-active); border-bottom: 2px solid var(--accent); }
        .tab-indicator { width: 6px; height: 6px; border-radius: 50%; background-color: var(--text-muted); flex-shrink: 0; }
        .tab.active .tab-indicator { background-color: var(--accent); }
        .tab-title { font-size: 12px; font-weight: 400; color: var(--text-secondary); max-width: 140px; overflow: hidden; text-overflow: ellipsis; }
        .tab.active .tab-title { font-weight: 600; color: var(--text-primary); }
        .tab-close { font-size: 14px; color: var(--text-muted); cursor: pointer; line-height: 1; padding: 2px 4px; border-radius: 4px; transition: color 0.15s ease; }
        .tab-close:hover { color: var(--negative); }
        .new-tab-button { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 6px; cursor: pointer; font-size: 16px; color: var(--text-muted); flex-shrink: 0; margin-left: 4px; transition: all 0.15s ease; background-color: transparent; }
        .new-tab-button:hover { background-color: var(--bg-tab-active); color: var(--text-primary); }
        .vertical-divider { width: 1px; height: 20px; background-color: var(--border); margin: 0 8px; flex-shrink: 0; }
        .nav-controls { display: flex; gap: 4px; flex-shrink: 0; }
        .nav-button { font-size: 11px; color: var(--text-muted); padding: 4px; opacity: 0.5; cursor: not-allowed; }
        .omnibox { display: flex; align-items: center; gap: 8px; padding: 0 12px; height: 30px; border-radius: 6px; border: 1px solid var(--border); background-color: rgba(10, 14, 23, 0.5); min-width: 220px; max-width: 320px; }
        .search-icon { width: 14px; height: 14px; stroke: var(--text-muted); stroke-width: 2; stroke-linecap: round; fill: none; }
        .search-input { background: transparent; border: none; outline: none; color: var(--text-primary); font-size: 12px; width: 100%; }
        .search-input::placeholder { color: var(--text-muted); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* CONTENT WRAPPER: content-area (flex) + chat global (300px)       */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .content-wrapper { flex: 1; display: flex; overflow: hidden; }
        .content-area { flex: 1; background-color: var(--bg-primary); overflow-y: auto; overflow-x: hidden; scrollbar-width: none; }
        .content-area::-webkit-scrollbar { display: none; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*                    CHAT GLOBAL (columna derecha fija)             */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .global-chat { width: 300px; min-width: 300px; background-color: var(--bg-sidebar); border-left: 1px solid var(--border); display: flex; flex-direction: column; height: 100%; overflow: hidden; }
        .global-chat-header { padding: 14px 16px; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(13, 18, 32, 1) 0%, rgba(10, 14, 23, 1) 100%); flex-shrink: 0; }
        .global-chat-title { font-size: 14px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .global-chat-subtitle { font-size: 11px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }
        .gc-live-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--positive); animation: gcPulse 1.5s ease-in-out infinite; }
        @keyframes gcPulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } }

        .gc-filters { padding: 10px 16px; border-bottom: 1px solid var(--border); display: flex; gap: 6px; flex-wrap: wrap; flex-shrink: 0; background-color: var(--bg-card); }
        .gc-filter-btn { padding: 4px 10px; border-radius: 12px; border: 1px solid var(--border); background: transparent; color: var(--text-secondary); font-size: 10px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
        .gc-filter-btn:hover { border-color: var(--accent); color: var(--text-primary); }
        .gc-filter-btn.active { background: var(--accent); color: var(--bg-primary); border-color: var(--accent); font-weight: 700; }

        .gc-messages { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
        .gc-messages::-webkit-scrollbar { width: 4px; }
        .gc-messages::-webkit-scrollbar-track { background: transparent; }
        .gc-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

        .gc-message { display: flex; gap: 10px; padding: 10px; border-radius: 10px; background-color: var(--bg-primary); border: 1px solid var(--border); animation: gcFadeIn 0.3s ease; position: relative; }
        @keyframes gcFadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .gc-msg-avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .gc-msg-content { display: flex; flex-direction: column; gap: 3px; flex: 1; min-width: 0; }
        .gc-msg-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        .gc-msg-user { font-size: 11px; font-weight: 600; color: var(--text-secondary); }
        .gc-msg-source { font-size: 9px; font-weight: 600; padding: 2px 6px; border-radius: 4px; color: white; white-space: nowrap; }
        .gc-msg-text { font-size: 12px; color: var(--text-primary); line-height: 1.4; word-wrap: break-word; }
        .gc-msg-time { font-size: 9px; color: var(--text-muted); margin-top: 2px; }
        .gc-msg-star { position: absolute; top: 6px; right: 8px; font-size: 10px; color: var(--accent); }

        .gc-empty { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; padding: 24px; text-align: center; }
        .gc-empty-icon { font-size: 36px; opacity: 0.5; }
        .gc-empty-title { font-size: 14px; font-weight: 600; color: var(--text-secondary); }
        .gc-empty-desc { font-size: 11px; color: var(--text-muted); line-height: 1.5; }

        .gc-footer { padding: 10px 16px; border-top: 1px solid var(--border); flex-shrink: 0; background: var(--bg-card); display: flex; align-items: center; justify-content: space-between; }
        .gc-footer-stats { font-size: 10px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }
        .gc-footer-count { font-weight: 700; color: var(--accent); }
        .gc-clear-btn { padding: 4px 10px; border-radius: 6px; border: 1px solid var(--border); background: transparent; color: var(--text-muted); font-size: 10px; cursor: pointer; transition: all 0.2s ease; }
        .gc-clear-btn:hover { border-color: var(--negative); color: var(--negative); }

        .module-iframe { width: 100%; height: 100%; border: none; background-color: var(--bg-primary); }

        /* â”€â”€ WELCOME PAGE â”€â”€ */
        .dashboard-home { padding: 32px; margin: 0 auto; height: 100%; max-width: 100%; }
        .welcome-header { text-align: center; margin-bottom: 32px; }
        .welcome-title { font-size: 28px; font-weight: 300; color: var(--text-primary); margin: 0 0 6px; }
        .welcome-title .brand-name { font-weight: 700; }
        .welcome-title .pro-label { font-style: italic; font-weight: 300; color: var(--accent); }
        .welcome-subtitle { font-size: 14px; color: var(--text-secondary); margin: 0; }
        .main-search { display: flex; justify-content: center; margin-bottom: 36px; }
        .main-search-container { display: flex; align-items: center; gap: 10px; padding: 0 20px; height: 42px; border-radius: 8px; border: 1px solid var(--border-light); background-color: var(--bg-card); width: 100%; max-width: 500px; }
        .main-search-text { font-size: 13px; color: var(--text-muted); }
        .welcome-cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 36px; }
        .welcome-card { background-color: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; cursor: pointer; transition: all 0.25s ease; display: flex; flex-direction: column; gap: 12px; }
        .welcome-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(245, 158, 11, 0.06); }
        .card-header { display: flex; align-items: center; gap: 14px; }
        .card-icon-container { width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .card-title { font-size: 16px; font-weight: 700; color: var(--text-primary); margin: 0; line-height: 1.3; }
        .card-description { font-size: 13px; color: var(--text-secondary); margin: 0; line-height: 1.5; }
        .card-features { margin: 0; padding: 0; list-style: none; display: flex; flex-direction: column; gap: 6px; flex: 1; }
        .card-feature { font-size: 12.5px; color: var(--text-secondary); display: flex; align-items: flex-start; gap: 8px; line-height: 1.4; }
        .feature-bullet { width: 5px; height: 5px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; opacity: 0.7; }
        .card-cta { display: flex; align-items: center; gap: 6px; margin-top: 8px; }
        .cta-text { font-size: 13px; font-weight: 600; }
        .cta-arrow { font-size: 16px; }
        .action-cards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 700px; margin: 0 auto; }
        .action-card { background-color: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 28px 24px; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .action-title { font-size: 16px; font-weight: 700; color: var(--text-primary); margin: 0; }
        .action-description { font-size: 13px; color: var(--text-secondary); margin: 0; }
        .action-button { margin-top: 8px; padding: 10px 24px; border-radius: 6px; border: none; background-color: var(--accent); color: var(--bg-primary); font-size: 12px; font-weight: 700; letter-spacing: 0.5px; cursor: pointer; transition: all 0.2s ease; }
        .action-button:hover { background-color: var(--accent-soft); transform: scale(1.02); }
        .tab-content { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 40px; gap: 20px; }
        .tab-emoji { font-size: 48px; }
        .tab-content-title { font-size: 24px; font-weight: 700; color: var(--text-primary); margin: 0; }
        .tab-content-description { font-size: 14px; color: var(--text-secondary); margin: 0; text-align: center; max-width: 400px; line-height: 1.6; }
        .status-indicator { display: flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 20px; background-color: rgba(245, 158, 11, 0.08); border: 1px solid rgba(245, 158, 11, 0.18); }
        .pulse-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--positive); animation: pulseAnim 2s ease-in-out infinite; }
        @keyframes pulseAnim { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.85); } }
        .status-text { font-size: 12px; color: var(--accent); font-weight: 600; }
        .hidden { display: none !important; }
        @media (max-width: 768px) { .welcome-cards-grid { grid-template-columns: 1fr; } .action-cards-grid { grid-template-columns: 1fr; } .dashboard-home { padding: 16px; } .global-chat { display: none; } }
    </style>
</head>
<body>
    <!--==================================-->
    <div class="app-container">
        <div class="sidebar">
            <!-- â•â•â• PROFILE AVATAR â€” solo la imagen, SIN popup adentro â•â•â• -->
            <div class="sidebar-profile" id="sidebarProfile">
                <div class="sidebar-avatar-fallback" id="avatarFallback">DT</div>
                <img class="sidebar-avatar" id="avatarImg" style="display:none;" alt="Avatar" referrerpolicy="no-referrer">
            </div>
            <div class="sidebar-divider"></div>
            <div class="sidebar-item" data-id="newsfeed" data-label="Newsfeed" title="Newsfeed"><svg class="sidebar-icon" viewBox="0 0 24 24"><path d="M4 4h16v16H4z"></path><path d="M8 8h4"></path><path d="M8 12h8"></path><path d="M8 16h6"></path></svg><span class="sidebar-label">Newsfeed</span></div>
            <div class="sidebar-item" data-id="details" data-label="Details" title="Details"><svg class="sidebar-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"></circle><path d="M16.5 16.5L21 21"></path></svg><span class="sidebar-label">Details</span></div>
            <div class="sidebar-item" data-id="calendar" data-label="Calendar" title="Calendar"><svg class="sidebar-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"></rect><path d="M3 10h18"></path><path d="M8 2v4"></path><path d="M16 2v4"></path></svg><span class="sidebar-label">Calendar</span></div>
            <div class="sidebar-item" data-id="watchlist" data-label="Watchlist" title="Watchlist"><svg class="sidebar-icon" viewBox="0 0 24 24"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7S2 12 2 12z"></path><circle cx="12" cy="12" r="3"></circle></svg><span class="sidebar-label">Watchlist</span></div>
            <div class="sidebar-item" data-id="movers" data-label="Movers" title="Movers"><svg class="sidebar-icon" viewBox="0 0 24 24"><path d="M22 7l-6 6-4-4-8 8"></path><path d="M16 7h6v6"></path></svg><span class="sidebar-label">Movers</span></div>
            <div class="sidebar-item" data-id="signals" data-label="Signals" title="Signals"><svg class="sidebar-icon" viewBox="0 0 24 24"><path d="M12 20V10"></path><path d="M6 20v-4"></path><path d="M18 20v-8"></path></svg><span class="sidebar-label">Signals</span></div>
            <div class="sidebar-item" data-id="scanner" data-label="Scanner" title="Scanner"><svg class="sidebar-icon" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"></rect><rect x="14" y="3" width="7" height="7" rx="1"></rect><rect x="3" y="14" width="7" height="7" rx="1"></rect><rect x="14" y="14" width="7" height="7" rx="1"></rect></svg><span class="sidebar-label">Scanner</span></div>
            <div class="sidebar-item" data-id="chart" data-label="Chart" title="Chart"><svg class="sidebar-icon" viewBox="0 0 24 24"><path d="M3 3v18h18"></path><path d="M7 16l4-6 4 4 5-8"></path></svg><span class="sidebar-label">Chart</span></div>
            <div class="sidebar-item" data-id="insiders" data-label="Insiders" title="Insiders"><svg class="sidebar-icon" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path><circle cx="10" cy="7" r="4"></circle><path d="M20 8v6"></path><path d="M17 11h6"></path></svg><span class="sidebar-label">Insiders</span></div>
            <div class="sidebar-item" data-id="graph" data-label="Graph" title="Graph"><svg class="sidebar-icon" viewBox="0 0 24 24"><circle cx="6" cy="6" r="2"></circle><circle cx="18" cy="6" r="2"></circle><circle cx="6" cy="18" r="2"></circle><circle cx="18" cy="18" r="2"></circle><path d="M8 6h8"></path><path d="M6 8v8"></path><path d="M18 8v8"></path><path d="M8 18h8"></path></svg><span class="sidebar-label">Graph</span></div>
        </div>

        <div class="main-content">
            <div class="tab-bar">
                <div class="tab-container" id="tabContainer"></div>
                <div class="new-tab-button" id="newTabButton" title="Nueva pestana">+</div>
                <div class="vertical-divider"></div>
                <div class="nav-controls"><span class="nav-button">â—</span><span class="nav-button">â–·</span></div>
                <div class="omnibox"><svg class="search-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"></circle><path d="M21 21l-4.35-4.35"></path></svg><input type="text" class="search-input" placeholder="Search assets or courses..." id="searchInput"></div>
            </div>

            <!-- CONTENT WRAPPER: mÃ³dulos + chat global -->
            <div class="content-wrapper">
                <div class="content-area" id="contentArea"></div>

                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- CHAT GLOBAL - Mensajes destacados de todos los mÃ³dulos  -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <div class="global-chat" id="globalChat">
                    <div class="global-chat-header">
                        <div class="global-chat-title">â­ Global Feed</div>
                        <div class="global-chat-subtitle"><span class="gc-live-dot"></span><span id="gcCount">0</span> highlighted messages</div>
                    </div>
                    <div class="gc-filters" id="gcFilters"><button class="gc-filter-btn active" data-filter="all">All</button></div>
                    <div class="gc-messages" id="gcMessages">
                        <div class="gc-empty" id="gcEmpty">
                            <span class="gc-empty-icon">â­</span>
                            <span class="gc-empty-title">No highlighted messages yet</span>
                            <span class="gc-empty-desc">Star important messages in any module chat and they'll appear here.</span>
                        </div>
                    </div>
                    <div class="gc-footer">
                        <div class="gc-footer-stats"><span class="gc-footer-count" id="gcTotal">0</span><span>total</span></div>
                        <button class="gc-clear-btn" id="gcClearBtn">Clear all</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PROFILE POPUP + OVERLAY â€” FUERA del sidebar (a nivel de body)        -->
    <!-- Esto evita que el overflow:auto del sidebar lo recorte/oculte        -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="profile-popup-overlay" id="profileOverlay"></div>
    <div class="profile-popup" id="profilePopup">
        <div class="profile-popup-header">
            <div class="profile-popup-avatar-fallback" id="popupAvatarFallback">DT</div>
            <img class="profile-popup-avatar" id="popupAvatarImg" style="display:none;" alt="Avatar" referrerpolicy="no-referrer">
            <div class="profile-popup-info">
                <div class="profile-popup-name" id="popupName">â€”</div>
                <div class="profile-popup-email" id="popupEmail">â€”</div>
            </div>
        </div>
        <div class="profile-popup-actions">
            <button class="profile-popup-btn" id="btnLogout">
                <svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                Cerrar sesiÃ³n
            </button>
        </div>
    </div>

    <!--==================================-->
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONFIGURACIÃ“N
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var WELCOME_CARDS_DATA = [
            { id: "guidebook", title: "Your Guidebook", subtitle: "Your Launch Guide: Dive into the Pro Experience", icon: "book", accentColor: "#3b82f6", cta: "Show more", bullets: ["Complete beginner's guide", "Discover features, tips and tricks!", "Reach your full potential with Pro!"] },
            { id: "options", title: "Options Trading", subtitle: "Speculate on the future direction of the overall stock market.", icon: "options", accentColor: "#8b5cf6", cta: "Show more", bullets: ["Tracking Options activity", "Chat with other options traders", "Most active option chains"] },
            { id: "swing", title: "Swing Trading", subtitle: "Maximizes short-term profit potential by capturing market swings.", icon: "swing", accentColor: "#06b6d4", cta: "Show more", bullets: ["Knowing % moves (week, month, year)", "Set up custom alerts for tickers", "Find where the momentum is"] },
            { id: "daytrading", title: "Day Trading", subtitle: "See stocks moving higher or that might go higher that day.", icon: "daytrading", accentColor: "#f59e0b", cta: "Show more", bullets: ["Entirely customizable dashboard", "Set up several charts", "Active room with live trades"] },
            { id: "longterm", title: "Long Term Investing", subtitle: "Keep investments for at least a year: stocks, bonds, real estate.", icon: "longterm", accentColor: "#22c55e", cta: "Show more", bullets: ["Dashboard rooted in financial info", "Prioritize news feed with custom notifications"] }
        ];

        var TAB_CONTENT_MAP = { guidebook:{emoji:"ğŸ“–",desc:"Interactive guides and tutorials"},options:{emoji:"ğŸ“Š",desc:"Real-time options flow scanner"},swing:{emoji:"ğŸ“ˆ",desc:"Multi-timeframe momentum scanner"},daytrading:{emoji:"âš¡",desc:"Level 2 data and position tracker"},longterm:{emoji:"ğŸ¦",desc:"Fundamental analysis dashboard"},create_workspace:{emoji:"ğŸ› ï¸",desc:"Build a convenient dashboard for your goals"},brokerage:{emoji:"ğŸ”—",desc:"Connect your brokers portfolio to DonTrading"},newsfeed:{emoji:"ğŸ“°",desc:"Curated financial news"},details:{emoji:"ğŸ”",desc:"Deep-dive company analysis"},calendar:{emoji:"ğŸ“…",desc:"Earnings calendar and events"},watchlist:{emoji:"ğŸ‘",desc:"Custom watchlists with alerts"},movers:{emoji:"ğŸš€",desc:"Top gainers and losers"},signals:{emoji:"ğŸ“¡",desc:"AI-generated trading signals"},scanner:{emoji:"ğŸ¯",desc:"Custom stock screener"},chart:{emoji:"ğŸ“‰",desc:"Advanced charting tools"},insiders:{emoji:"ğŸ‘¥",desc:"Insider trading activity"},graph:{emoji:"ğŸ”—",desc:"Company relationship maps"},welcome:{emoji:"ğŸ ",desc:"Welcome to your dashboard"} };

        var MODULE_FILES = {
            // â”€â”€ Welcome Cards â”€â”€
            guidebook:        'modules/guidebook.html',
            options:          'modules/options.html',
            swing:            'modules/swing.html',
            daytrading:       'modules/day_trading.html',
            longterm:         'modules/long_term.html',
            // â”€â”€ Action Cards â”€â”€
            create_workspace: 'modules/create_workspace.html',
            brokerage:        'modules/Brokerage.html',
            // â”€â”€ Sidebar Items â”€â”€
            newsfeed:         'modules/newsfeed.html',
            details:          'modules/details.html',
            calendar:         'modules/calendar.html',
            watchlist:        'modules/watchlist.html',
            movers:           'modules/movers.html',
            signals:          'modules/signals.html',
            scanner:          'modules/scanner.html',
            chart:            'modules/chart.html',
            insiders:         'modules/insiders.html',
            graph:            'modules/graph.html'
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ESTADO
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var appState = { tabs: [{ id: "welcome", title: "Welcome Page", contentId: "welcome", closable: false }], activeTabId: "welcome", activeSidebarItem: null, nextTabId: 1 };

        // Estado del Chat Global
        var gcState = { messages: [], activeFilter: 'all', sources: {}, max: 200 };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILIDADES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function hexToRgba(hex, alpha) { var c = hex.replace("#",""); return "rgba("+parseInt(c.substring(0,2),16)+","+parseInt(c.substring(2,4),16)+","+parseInt(c.substring(4,6),16)+","+alpha+")"; }

        function getCardIconSvg(type, color) {
            var p = { book:['M4 19.5A2.5 2.5 0 016.5 17H20','M4 4.5A2.5 2.5 0 016.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15z','M8 7h6','M8 11h4'], options:['M12 2L2 7l10 5 10-5-10-5z','M2 17l10 5 10-5','M2 12l10 5 10-5'], swing:['M2 12c2-4 4-4 6 0s4 4 6 0 4-4 6 0 4 4 6 0'], daytrading:['M13 2L3 14h9l-1 8 10-12h-9l1-8z'], longterm:['M3 21h18','M5 21V7l7-4 7 4v14','M9 21v-6h6v6','M10 10h1','M14 10h1'] };
            var paths = p[type] || ['M12 12m-8 0a8 8 0 1 0 16 0a8 8 0 1 0-16 0'];
            var svg = '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="'+color+'" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">';
            for (var i=0;i<paths.length;i++) svg+='<path d="'+paths[i]+'"></path>';
            return svg+'</svg>';
        }

        function formatTime(ts) { var d=new Date(ts),h=('0'+d.getHours()).slice(-2),m=('0'+d.getMinutes()).slice(-2); return h+':'+m; }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CHAT GLOBAL - Recibe mensajes de iframes via postMessage
        //
        // Los mÃ³dulos (iframes) envÃ­an mensajes con este formato:
        //   window.parent.postMessage({
        //     type: 'DONTRADING_HIGHLIGHT',
        //     user: 'TraderPro',
        //     avatar: 'ğŸ§‘â€ğŸ’¼',
        //     text: 'AAPL se ve interesante',
        //     source: 'AAPL',
        //     sourceColor: '#3b82f6',
        //     module: 'guidebook',
        //     timestamp: Date.now()
        //   }, '*');
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function initGlobalChat() {
            window.addEventListener('message', function(e) {
                if (e.data && e.data.type === 'DONTRADING_HIGHLIGHT') {
                    addGlobalMessage(e.data);
                }
            });
            document.getElementById('gcClearBtn').addEventListener('click', clearGlobalChat);
            console.log('[GlobalChat] âœ… Listening for highlights...');
        }

        function addGlobalMessage(data) {
            var msg = {
                user: data.user || 'Unknown', avatar: data.avatar || 'ğŸ’¬',
                text: data.text || '', source: data.source || 'General',
                sourceColor: data.sourceColor || '#64748b',
                module: data.module || 'unknown', timestamp: data.timestamp || Date.now()
            };

            gcState.messages.push(msg);
            if (gcState.messages.length > gcState.max) gcState.messages.shift();

            // Registrar fuente para filtros
            if (!gcState.sources[msg.source]) {
                gcState.sources[msg.source] = msg.sourceColor;
                renderGcFilters();
            }

            renderGcMessage(msg);
            updateGcCounts();
        }

        function renderGcMessage(msg) {
            var container = document.getElementById('gcMessages');
            var empty = document.getElementById('gcEmpty');
            if (empty) empty.style.display = 'none';

            var show = gcState.activeFilter === 'all' || gcState.activeFilter === msg.source;

            container.insertAdjacentHTML('beforeend',
                '<div class="gc-message" data-source="'+msg.source+'" '+(show?'':'style="display:none"')+'>' +
                    '<div class="gc-msg-avatar" style="background-color:'+msg.sourceColor+'">'+msg.avatar+'</div>' +
                    '<div class="gc-msg-content">' +
                        '<div class="gc-msg-header"><span class="gc-msg-user">'+msg.user+'</span><span class="gc-msg-source" style="background-color:'+msg.sourceColor+'">'+msg.source+'</span></div>' +
                        '<span class="gc-msg-text">'+msg.text+'</span>' +
                        '<span class="gc-msg-time">'+formatTime(msg.timestamp)+'</span>' +
                    '</div>' +
                    '<span class="gc-msg-star">â­</span>' +
                '</div>'
            );
            container.scrollTop = container.scrollHeight;
        }

        function renderGcFilters() {
            var el = document.getElementById('gcFilters');
            var html = '<button class="gc-filter-btn '+(gcState.activeFilter==='all'?'active':'')+'" data-filter="all">All</button>';
            for (var s in gcState.sources) {
                var a = gcState.activeFilter === s;
                html += '<button class="gc-filter-btn '+(a?'active':'')+'" data-filter="'+s+'" style="'+(a?'background:'+gcState.sources[s]+';border-color:'+gcState.sources[s]:'')+'">'+s+'</button>';
            }
            el.innerHTML = html;

            var btns = el.querySelectorAll('.gc-filter-btn');
            for (var i=0;i<btns.length;i++) {
                (function(b) { b.addEventListener('click', function() {
                    gcState.activeFilter = b.getAttribute('data-filter');
                    renderGcFilters();
                    applyGcFilter();
                }); })(btns[i]);
            }
        }

        function applyGcFilter() {
            var msgs = document.querySelectorAll('.gc-message');
            for (var i=0;i<msgs.length;i++) {
                var src = msgs[i].getAttribute('data-source');
                msgs[i].style.display = (gcState.activeFilter==='all'||src===gcState.activeFilter) ? '' : 'none';
            }
        }

        function updateGcCounts() {
            var c = gcState.messages.length;
            document.getElementById('gcCount').textContent = c;
            document.getElementById('gcTotal').textContent = c;
        }

        function clearGlobalChat() {
            gcState.messages = []; gcState.sources = {}; gcState.activeFilter = 'all';
            document.getElementById('gcMessages').innerHTML = '<div class="gc-empty" id="gcEmpty"><span class="gc-empty-icon">â­</span><span class="gc-empty-title">No highlighted messages yet</span><span class="gc-empty-desc">Star important messages in any module chat and they\'ll appear here.</span></div>';
            renderGcFilters(); updateGcCounts();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WELCOME PAGE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderWelcomePage() {
            var h='';
            for(var i=0;i<WELCOME_CARDS_DATA.length;i++){var c=WELCOME_CARDS_DATA[i],b='';for(var j=0;j<c.bullets.length;j++)b+='<li class="card-feature"><span class="feature-bullet" style="background-color:'+c.accentColor+'"></span>'+c.bullets[j]+'</li>';h+='<div class="welcome-card" data-card-id="'+c.id+'" data-card-title="'+c.title+'" style="border-top:2px solid '+hexToRgba(c.accentColor,0.15)+'"><div class="card-header"><div class="card-icon-container" style="background-color:'+hexToRgba(c.accentColor,0.07)+'">'+getCardIconSvg(c.icon,c.accentColor)+'</div><h3 class="card-title">'+c.title+'</h3></div><p class="card-description">'+c.subtitle+'</p><ul class="card-features">'+b+'</ul><div class="card-cta"><span class="cta-text" style="color:'+c.accentColor+'">'+c.cta+'</span><span class="cta-arrow" style="color:'+c.accentColor+'">â†’</span></div></div>';}
            return '<div class="dashboard-home"><div class="welcome-header"><h1 class="welcome-title">Welcome, <span class="brand-name" id="welcomeUserName">Trader</span> <span class="pro-label">Pro</span></h1><p class="welcome-subtitle">Choose the type of trading that suits you best</p></div><div class="main-search"><div class="main-search-container"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2"><circle cx="11" cy="11" r="7"></circle><path d="M21 21l-4.35-4.35"></path></svg><span class="main-search-text">Search a...</span></div></div><div class="welcome-cards-grid">'+h+'</div><div class="action-cards-grid"><div class="action-card"><h3 class="action-title">Create New Workspace</h3><p class="action-description">Build a convenient dashboard for your goals</p><button class="action-button" data-action-id="create_workspace" data-action-title="Create Workspace">CREATE WORKSPACE</button></div><div class="action-card"><h3 class="action-title">Link Brokerage Portfolio</h3><p class="action-description">Connect your brokers portfolio to DonTrading</p><button class="action-button" data-action-id="brokerage" data-action-title="Link Brokerage">LINK BROKERAGE</button></div></div></div>';
        }

        function renderTabContent(t,id){var c=TAB_CONTENT_MAP[id]||{emoji:"ğŸ“‹",desc:"Content for "+t};return '<div class="tab-content"><span class="tab-emoji">'+c.emoji+'</span><h2 class="tab-content-title">'+t+'</h2><p class="tab-content-description">'+c.desc+'</p><div class="status-indicator"><div class="pulse-dot"></div><span class="status-text">Module Ready</span></div></div>';}

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PESTAÃ‘AS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderTabs(){var tc=document.getElementById('tabContainer');tc.innerHTML='';for(var i=0;i<appState.tabs.length;i++){var t=appState.tabs[i],el=document.createElement('div');el.className='tab'+(t.id===appState.activeTabId?' active':'');el.setAttribute('data-tab-id',t.id);var cb=t.closable!==false?'<span class="tab-close" data-tab-close="'+t.id+'">âœ•</span>':'';el.innerHTML='<div class="tab-indicator"></div><span class="tab-title">'+t.title+'</span>'+cb;(function(id){el.addEventListener('click',function(e){if(!e.target.hasAttribute('data-tab-close'))setActiveTab(id);})})(t.id);tc.appendChild(el);}}

        function updateContent(){var ca=document.getElementById('contentArea'),gc=document.getElementById('globalChat'),at=null;for(var i=0;i<appState.tabs.length;i++){if(appState.tabs[i].id===appState.activeTabId){at=appState.tabs[i];break;}}if(!at){ca.innerHTML='<div class="tab-content">No tab selected</div>';return;}if(at.contentId==='welcome'){ca.innerHTML=renderWelcomePage();setupWelcomeCardListeners();gc.style.display='flex';}else if(MODULE_FILES[at.contentId]){ca.innerHTML='<iframe class="module-iframe" src="'+MODULE_FILES[at.contentId]+'"></iframe>';gc.style.display='none';}else{ca.innerHTML=renderTabContent(at.title,at.contentId);gc.style.display='none';}}

        function setupWelcomeCardListeners(){var wc=document.querySelectorAll('.welcome-card');for(var i=0;i<wc.length;i++){(function(c){c.addEventListener('click',function(){openNewTab(c.getAttribute('data-card-id'),c.getAttribute('data-card-title'));});})(wc[i]);}var ab=document.querySelectorAll('.action-button[data-action-id]');for(var j=0;j<ab.length;j++){(function(b){b.addEventListener('click',function(){openNewTab(b.getAttribute('data-action-id'),b.getAttribute('data-action-title'));});})(ab[j]);}}
        function updateSidebar(){var si=document.querySelectorAll('.sidebar-item');for(var i=0;i<si.length;i++){si[i].classList.remove('active');if(si[i].getAttribute('data-id')===appState.activeSidebarItem)si[i].classList.add('active');}}
        function openNewTab(cid,t){for(var i=0;i<appState.tabs.length;i++){if(appState.tabs[i].contentId===cid){setActiveTab(appState.tabs[i].id);return;}}var nid='tab-'+appState.nextTabId;appState.tabs.push({id:nid,title:t,contentId:cid,closable:true});appState.activeTabId=nid;appState.nextTabId++;renderTabs();updateContent();}
        function closeTab(tid){var idx=-1;for(var i=0;i<appState.tabs.length;i++){if(appState.tabs[i].id===tid){idx=i;break;}}if(idx===-1||appState.tabs[idx].closable===false)return;appState.tabs.splice(idx,1);if(appState.activeTabId===tid){appState.activeTabId=appState.tabs.length>0?appState.tabs[0].id:"welcome";if(appState.tabs.length===0)appState.tabs.push({id:"welcome",title:"Welcome Page",contentId:"welcome",closable:false});}renderTabs();updateContent();}
        function setActiveTab(id){appState.activeTabId=id;renderTabs();updateContent();}
        function handleSidebarClick(id,l){appState.activeSidebarItem=id;updateSidebar();openNewTab(id,l);}

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INICIALIZACIÃ“N
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initializeApp(){renderTabs();updateContent();updateSidebar();initGlobalChat();var si=document.querySelectorAll('.sidebar-item');for(var i=0;i<si.length;i++){(function(it){it.addEventListener('click',function(){handleSidebarClick(it.getAttribute('data-id'),it.getAttribute('data-label'));});})(si[i]);}document.addEventListener('click',function(e){if(e.target.hasAttribute('data-tab-close')){e.stopPropagation();closeTab(e.target.getAttribute('data-tab-close'));}});document.getElementById('newTabButton').addEventListener('click',function(){openNewTab('welcome','New Tab');});}

        document.addEventListener('DOMContentLoaded',function(){console.log('ğŸš€ DONTRADING v2.1 (Modular + Global Chat)');initializeApp();});

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FIREBASE INIT + PERFIL DINÃMICO + LOGOUT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        var firebaseConfig = {
            apiKey: "AIzaSyAdKShZMYYdmZ3bkmaDWsEhsLsT0YIgz-8",
            authDomain: "dontrading-pro.firebaseapp.com",
            projectId: "dontrading-pro",
            storageBucket: "dontrading-pro.firebasestorage.app",
            messagingSenderId: "684854856085",
            appId: "1:684854856085:web:fd18dc2c46ff13ea81ce9c",
            measurementId: "G-FYNX14F2VY"
        };

        firebase.initializeApp(firebaseConfig);
        var auth = firebase.auth();

        // â”€â”€ Poblar la UI con datos del usuario â”€â”€
        function populateUserProfile(user) {
            var displayName = user.displayName || user.email || 'Trader';
            var email = user.email || '';
            var photoURL = user.photoURL || '';
            var firstName = displayName.split(' ')[0];
            var initial = firstName.charAt(0).toUpperCase();

            // â”€â”€ Sidebar avatar â”€â”€
            var avatarImg = document.getElementById('avatarImg');
            var avatarFallback = document.getElementById('avatarFallback');

            if (photoURL) {
                avatarImg.src = photoURL;
                avatarImg.style.display = 'block';
                avatarFallback.style.display = 'none';
                avatarImg.onerror = function() {
                    avatarImg.style.display = 'none';
                    avatarFallback.style.display = 'flex';
                    avatarFallback.textContent = initial;
                };
            } else {
                avatarImg.style.display = 'none';
                avatarFallback.style.display = 'flex';
                avatarFallback.textContent = initial;
            }

            // â”€â”€ Popup avatar â”€â”€
            var popupAvatarImg = document.getElementById('popupAvatarImg');
            var popupAvatarFallback = document.getElementById('popupAvatarFallback');

            if (photoURL) {
                popupAvatarImg.src = photoURL;
                popupAvatarImg.style.display = 'block';
                popupAvatarFallback.style.display = 'none';
                popupAvatarImg.onerror = function() {
                    popupAvatarImg.style.display = 'none';
                    popupAvatarFallback.style.display = 'flex';
                    popupAvatarFallback.textContent = initial;
                };
            } else {
                popupAvatarImg.style.display = 'none';
                popupAvatarFallback.style.display = 'flex';
                popupAvatarFallback.textContent = initial;
            }

            // â”€â”€ Popup info â”€â”€
            document.getElementById('popupName').textContent = displayName;
            document.getElementById('popupEmail').textContent = email;

            // â”€â”€ Welcome page (si ya renderizada) â”€â”€
            var welcomeName = document.getElementById('welcomeUserName');
            if (welcomeName) welcomeName.textContent = firstName;

            console.log('ğŸ‘¤ Perfil cargado: ' + displayName + ' (' + email + ')');
        }

        // â”€â”€ Auth State Observer â”€â”€
        auth.onAuthStateChanged(function(user) {
            if (user) {
                console.log('âœ… [Dashboard] Autenticado: ' + user.uid);
                populateUserProfile(user);
            } else {
                console.log('ğŸ”’ [Dashboard] Sin sesiÃ³n â†’ login.html');
                window.location.href = 'login.html';
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PROFILE POPUP â€” position:fixed + JS getBoundingClientRect()
        // El popup vive FUERA del sidebar para evitar que overflow lo recorte
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openProfilePopup() {
            var avatarEl = document.getElementById('sidebarProfile');
            var popup = document.getElementById('profilePopup');
            var overlay = document.getElementById('profileOverlay');

            // Calcular posiciÃ³n basada en el avatar
            var rect = avatarEl.getBoundingClientRect();
            popup.style.left = (rect.right + 8) + 'px';   // 8px a la derecha del sidebar
            popup.style.top = rect.top + 'px';              // alineado al top del avatar

            popup.classList.add('open');
            overlay.classList.add('open');
            console.log('ğŸ“‹ Popup abierto en left:' + popup.style.left + ' top:' + popup.style.top);
        }

        function closeProfilePopup() {
            document.getElementById('profilePopup').classList.remove('open');
            document.getElementById('profileOverlay').classList.remove('open');
        }

        // Click en avatar â†’ toggle popup
        document.getElementById('sidebarProfile').addEventListener('click', function(e) {
            e.stopPropagation();
            var popup = document.getElementById('profilePopup');
            if (popup.classList.contains('open')) {
                closeProfilePopup();
            } else {
                openProfilePopup();
            }
        });

        // Click en overlay â†’ cerrar
        document.getElementById('profileOverlay').addEventListener('click', function() {
            closeProfilePopup();
        });

        // Escape â†’ cerrar
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeProfilePopup();
        });

        // â”€â”€ Logout â”€â”€
        document.getElementById('btnLogout').addEventListener('click', function(e) {
            e.stopPropagation();
            closeProfilePopup();
            auth.signOut().then(function() {
                console.log('ğŸ‘‹ SesiÃ³n cerrada');
                window.location.href = 'login.html';
            }).catch(function(err) {
                console.error('Error logout:', err);
            });
        });

        // â”€â”€ Re-poblar nombre al cambiar de pestaÃ±a a Welcome â”€â”€
        var _origUpdateContent = updateContent;
        updateContent = function() {
            _origUpdateContent();
            var currentUser = auth.currentUser;
            if (currentUser) {
                var welcomeName = document.getElementById('welcomeUserName');
                if (welcomeName) {
                    welcomeName.textContent = (currentUser.displayName || currentUser.email || 'Trader').split(' ')[0];
                }
            }
        };
    </script>
    <!--==================================-->
</body>
</html>